version: "2"

services:
    mysql:
        image: mysql:latest
        volumes:
            - "./.mysql-data/db:/var/lib/mysql"
        restart: "on-failure"
        ports:
            - 127.0.0.1:3306:3306
        environment:
            MYSQL_ALLOW_EMPTY_PASSWORD: "yes"
            MYSQL_DATABASE: $DB_DATABASE
            MYSQL_USER: $DB_USERNAME
            MYSQL_PASSWORD: $DB_PASSWORD

    web:
        image: sergeyb/dev
        ports:
            - "80:80"
            - "443:443"
        volumes:
            - .:/var/www/public
        links:
            - mysql

    composer:
        restart: 'no'
        image: composer:latest
        command: install
        volumes:
            - .:/app